# Project Firmware 1.1 - Fix Log & Updates

## ðŸ“… Date: 2025-12-27

### âœ… Major Fixes & Improvements

#### 1. **ESC Initialization & Boot Timing Fix**
   - **Issue:** ESCs (specifically Motor 3) failed to arm when powered simultaneously with ESP32 via battery.
   - **Cause:** ESP32 boot time caused GPIO pins to float, sending invalid signals to ESCs before firmware initialization.
   - **Fix:** 
     - Moved `pwm_init()` to the very beginning of `app_main()`.
     - Added an immediate **5-second stable IDLE signal (1000Âµs)** sequence at boot.
     - This mimics "USB-first" behavior, allowing ESCs to recover from boot noise and arm properly.

#### 2. **GPIO Pin Remapping (Safety)**
   - **Issue:** Motors were connected to ESP32 strapping pins (GPIO 12, 14), causing boot glitches and potential failures.
   - **Fix:** Remapped motors to safe, non-strapping pins:
     - **Motor 2:** Changed from GPIO 12 â†’ **GPIO 25**
     - **Motor 3:** Changed from GPIO 14 â†’ **GPIO 33**
     - **Motor 1 (13)** and **Motor 4 (27)** remained unchanged.

#### 3. **Performance Optimization**
   - **Issue:** Serial `printf` statements in the main control loop caused delays and jitter.
   - **Fix:** Commented out all non-essential `printf` statements in `main.c` to ensure a stable 500Hz control loop.
   - **Boot Speed:** Removed unnecessary 3-second "BOOTING..." delay.

#### 4. **IMU Calibration Storage (NVS)**
   - **Feature:** Implemented Non-Volatile Storage (NVS) for IMU calibration.
   - **Benefit:** Gyro bias and Accel offsets are saved to flash memory. No need to keep the drone still on every boot!
   - **Usage:** Calibration runs once (or if NVS is empty), then loads automatically on subsequent boots.

#### 5. **Web-Based PID Tuning**
   - **Feature:** Integrated a lightweight web server for real-time PID tuning.
   - **Usage:** Connect to WiFi `QuadPID` (Pass: `12345678`) and go to `http://192.168.4.1`.
   - **Benefit:** Tune P, I, D gains wirelessly without recompiling code.

---

### ðŸ”Œ Updated Pin Mapping

| Component | Function | GPIO Pin | Status |
|-----------|----------|----------|--------|
| **Motor 1** | PWM Out | **13** | âœ… Safe |
| **Motor 2** | PWM Out | **25** | âœ… Safe |
| **Motor 3** | PWM Out | **33** | âœ… Safe |
| **Motor 4** | PWM Out | **27** | âœ… Safe |
| **RX Input** | PPM In | **26** | âœ… Safe |
| **SDA** | I2C Data | **21** | âœ… Safe |
| **SCL** | I2C Clock | **22** | âœ… Safe |
| **Battery** | ADC In | **35** | âœ… Safe |
| **LED** | Status | **2** | âœ… Safe |
| **Button** | E-Stop | **0** | âœ… Safe |

---

### ðŸš€ Next Steps
- [ ] Flight test with new PID values.
- [ ] Verify battery voltage scaling in web interface.
- [ ] Fine-tune Rate I and D gains for outdoor flight.
