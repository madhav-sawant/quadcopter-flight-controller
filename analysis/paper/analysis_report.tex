\documentclass[11pt,a4paper]{article}

% Font and Encoding
\usepackage{mathptmx}           % Times New Roman font
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}

% Layout and Formatting
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{booktabs}           % For nicer tables
\usepackage{caption}
\usepackage{float}

% TikZ for block diagrams
\usepackage{tikz}
\usetikzlibrary{shapes, arrows.meta, positioning, calc}

% Disable paragraph indentation, add space between paragraphs
\usepackage{parskip}

\begin{document}

% ===========================================================================
% SECTION 1: RATE MODE STABILITY ANALYSIS
% ===========================================================================

\section{Control System Stability Analysis}

The following analysis was conducted exclusively on a rate-mode PID control architecture, in which the pilot commands angular velocity and the controller tracks these setpoints using gyroscope feedback. The control loop operates at 250 Hz, providing sufficient bandwidth for stable flight control. The system components include an ESP32 microcontroller, an MPU6050 sensor, 1400 KV motors, an F450 frame, and a 2200 mAh battery.

This configuration represents a high mechanical-gain system, with a thrust-to-weight ratio of approximately 3.6:1. The system is primarily designed for payload lifting; however, it can also be operated in idle or low-load conditions where no weight-lifting operation is performed.

To verify the stability of the control system mathematically, the following analysis derives the system transfer functions and evaluates the closed-loop pole locations. This theoretical verification complements the empirical flight testing.

\subsection{PID Tuning Process}

The PID controller parameters were determined through iterative flight testing ("blackbox tuning") to achieve stable flight. The tuning process started with conservative values and progressively increased gains until optimal response was achieved without oscillation.

\begin{table}[H]
\centering
\caption{PID Tuning Iterations}
\label{tab:tuning}
\begin{tabular}{|l|c|c|c|l|}
\hline
\textbf{Iteration} & \textbf{$K_p$} & \textbf{$K_i$} & \textbf{$K_d$} & \textbf{Outcome} \\
\hline
Initial & 0.035 & 0.00 & 0.00 & Sluggish, drifting \\
Iteration 1 & 0.10 & 0.05 & 0.01 & Underpowered response \\
Iteration 2 & 0.25 & 0.10 & 0.02 & Improved, minor oscillation \\
Iteration 3 & 0.35 & 0.15 & 0.025 & Good, slight overshoot \\
Final & 0.40 & 0.20 & 0.03 & Stable, no oscillation \\
\hline
\end{tabular}
\end{table}

The final values were selected as they provided the best balance between responsiveness and stability for the high thrust-to-weight platform.

\subsection{System Modeling}

The quadcopter rotational dynamics are modeled based on Newton's Euler equations, simplified for single-axis rotation \cite{khatoon_dynamic, ijctac_pid}. The plant transfer function $G_p(s)$ relates the controller output to the angular velocity.

\subsubsection{Plant Block Components}

The Plant block in the control diagram represents the complete physical system from controller output to measured angular rate. It consists of three cascaded subsystems:

\begin{enumerate}
    \item \textbf{Motor/ESC Dynamics:} The electronic speed controller (ESC) and brushless DC motor are modeled as a first-order lag system with time constant $\tau_m$. This represents the delay between commanded throttle and actual motor speed.
    
    \item \textbf{Propeller Aerodynamics:} The rotating propellers generate thrust and torque proportional to the square of motor speed. For small perturbations around hover, this is linearized to a torque gain $K_\tau$.
    
    \item \textbf{Airframe Dynamics:} The rigid body rotation is governed by Newton's Euler equation $\tau = I\dot{\omega}$, where $I$ is the moment of inertia and $\omega$ is the angular rate. This relationship is an integrator ($1/s$) in the Laplace domain.
\end{enumerate}

Combining these subsystems, the plant transfer function is:

\begin{equation}
G_p(s) = \underbrace{\frac{1}{\tau_m s + 1}}_{\text{Motor}} \times \underbrace{K_\tau}_{\text{Propeller}} \times \underbrace{\frac{1}{s}}_{\text{Inertia}} = \frac{K_\tau}{s(\tau_m s + 1)}
\label{eq:plant}
\end{equation}

where $K_\tau$ is the torque gain and $\tau_m$ is the motor time constant.

\begin{table}[H]
\centering
\caption{System Parameters}
\label{tab:params}
\begin{tabular}{|l|c|c|c|}
\hline
\textbf{Parameter} & \textbf{Symbol} & \textbf{Value} & \textbf{Unit} \\
\hline
Motor-to-center distance & $r$ & 220 & mm \\
Total aircraft mass & $m$ & 880 & g \\
Moment of inertia & $I$ & 0.013 & kg$\cdot$m$^2$ \\
Torque gain & $K_\tau$ & 85 & deg/s$^2$ per unit \\
Motor time constant & $\tau_m$ & 30 & ms \\
\hline
\end{tabular}
\end{table}

Substituting the parameters into Equation \ref{eq:plant}:

\begin{equation}
G_p(s) = \frac{85}{0.030s^2 + s}
\end{equation}

\subsection{PID Controller}

The rate controller $G_c(s)$ implements a standard PID structure with a low-pass filter on the derivative term to attenuate noise:

\begin{equation}
G_c(s) = K_p + \frac{K_i}{s} + \frac{K_d s}{T_d s + 1}
\end{equation}

The derivative filter time constant $T_d$ is derived from the discrete low-pass filter coefficient $\alpha = 0.42$ and the sampling time $\Delta t = 4$ ms:
\begin{equation}
T_d = \Delta t \left(\frac{1 - \alpha}{\alpha}\right) = 4\text{ ms} \left(\frac{1 - 0.42}{0.42}\right) \approx 5.5\text{ ms}
\end{equation}

\begin{table}[H]
\centering
\caption{Controller Parameters}
\label{tab:pid_params}
\begin{tabular}{|l|c|c|c|}
\hline
\textbf{Parameter} & \textbf{Symbol} & \textbf{Value} & \textbf{Unit} \\
\hline
Proportional gain & $K_p$ & 0.40 & - \\
Integral gain & $K_i$ & 0.20 & s$^{-1}$ \\
Derivative gain & $K_d$ & 0.03 & s \\
D-term filter constant & $T_d$ & 5.5 & ms \\
Control loop frequency & $f$ & 250 & Hz \\
\hline
\end{tabular}
\end{table}

\subsection{Block Diagram}

\begin{figure}[H]
    \centering
    % Ensure you compile rate_mode_block.tex to rate_mode_block.pdf first
    \includegraphics[width=0.9\linewidth]{rate_mode_block.pdf}
    \caption{Rate Mode Control Loop Block Diagram}
    \label{fig:rate_block}
\end{figure}

\subsection{Stability Analysis}

The system operates in a closed-loop configuration with unity negative feedback from the gyroscope. The Closed-Loop Transfer Function $T(s)$ is derived as:

\begin{equation}
T(s) = \frac{G_c(s)G_p(s)}{1 + G_c(s)G_p(s)}
\end{equation}

Stability is determined by the poles of the closed-loop system, which are the roots of the characteristic equation $1 + G_c(s)G_p(s) = 0$. This analysis methodology aligns with standard stability verification techniques for UAVs \cite{ijrte_stability}.

\begin{table}[H]
\centering
\caption{Closed-Loop System Poles}
\label{tab:poles}
\begin{tabular}{|c|c|c|c|}
\hline
\textbf{Pole} & \textbf{Location} & \textbf{$\zeta$} & \textbf{$\omega_n$ (rad/s)} \\
\hline
1, 2 & $-102.6 \pm 100.4j$ & 0.71 & 143.5 \\
3 & -9.5 & - & - \\
4 & -0.5 & - & - \\
\hline
\end{tabular}
\end{table}

All poles reside in the left half of the s-plane, which confirms that the system is asymptotically stable. The dominant complex poles exhibit a damping ratio of $\zeta = 0.71$, which is near the optimal value of 0.707, indicating well-damped response.

\begin{figure}[H]
\centering
\includegraphics[width=0.8\linewidth]{rate_mode_s_plane.png}
\caption{Rate Mode: S-Plane Pole-Zero Map showing dominant poles with $\zeta = 0.71$.}
\label{fig:rate_s_plane}
\end{figure}



\subsection{Performance Evaluation}

The transient response was evaluated by simulating a unit step input to the closed-loop system.

\begin{table}[H]
\centering
\caption{Time Domain Performance Metrics}
\label{tab:metrics}
\begin{tabular}{|l|c|l|}
\hline
\textbf{Metric} & \textbf{Value} & \textbf{Interpretation} \\
\hline
Rise time (10-90\%) & 79 ms & Fast response to inputs \\
Settling time (2\%) & 239 ms & Quick convergence \\
Overshoot & 0\% & No oscillation \\
Steady-state error & 0\% & Zero tracking error \\
\hline
\end{tabular}
\end{table}

\begin{figure}[H]
\centering
\includegraphics[width=0.8\linewidth]{rate_mode_step_response.png}
\caption{Unit step response of the rate control loop showing zero overshoot.}
\label{fig:step}
\end{figure}

The frequency domain stability margins were verified using Bode analysis:

\begin{table}[H]
\centering
\caption{Stability Margins}
\label{tab:margins}
\begin{tabular}{|l|c|c|c|}
\hline
\textbf{Margin} & \textbf{Value} & \textbf{Requirement} & \textbf{Status} \\
\hline
Phase margin & 81$^\circ$ & $> 45^\circ$ & Satisfied \\
Gain margin & $> 20$ dB & $> 6$ dB & Satisfied \\
\hline
\end{tabular}
\end{table}

\begin{figure}[H]
\centering
\includegraphics[width=0.8\linewidth]{rate_mode_bode.png}
\caption{Bode plot showing Phase Margin of 81$^\circ$ and Gain Margin $> 20$ dB.}
\label{fig:bode}
\end{figure}

\subsection{Discussion \& Conclusion}

Flight testing confirmed stable operation without oscillation, consistent with the calculated damping ratio of $\zeta = 0.71$. The observed "drift" behavior during hover is characteristic of Rate Mode (which controls angular velocity, not attitude) and confirms correct operation of the rate loop.

The analysis validates that the implemented PID parameters ($K_p=0.40, K_i=0.20, K_d=0.03$) provide a stable, robust, and responsive control system for the F450 platform.

% ===========================================================================
% SECTION 2: ANGLE MODE STABILITY ANALYSIS
% ===========================================================================

\section{Angle Mode Stability Analysis}

Upon verifying and implementing the rate controller, we confirmed that it is working exactly as expected. Although some drift is observed, this behavior is expected because this mode relies solely on gyroscope feedback and is purely dependent on user inputs. This drift can be compensated for in angle mode.

Angle mode is implemented using a cascaded control architecture, in which the outer loop generates rate setpoints for the inner loop. In this mode, the pilot commands the desired attitude angles, and the controller maintains these angles using accelerometer-derived attitude feedback.

\subsection{Cascade Architecture}

The cascade control structure is commonly used in flight control systems. The angle mode control system consists of two cascaded loops:
\begin{itemize}
    \item \textbf{Inner Loop (Rate):} The previously verified rate controller with damping ratio $\zeta = 0.71$
    \item \textbf{Outer Loop (Angle):} A PI controller that generates rate setpoints based on angle error
\end{itemize}

This hierarchical structure ensures that the fast inner loop stabilizes angular rate dynamics while the slower outer loop tracks attitude references.

% Block Diagram - BLACK AND WHITE VERSION
\begin{figure}[H]
    \centering
    % Ensure you compile angle_mode_block.tex to angle_mode_block.pdf first
    \includegraphics[width=0.9\linewidth]{angle_mode_block.pdf}
    \caption{Cascade control block diagram with PI angle controller, inner PID rate controller, and Complementary Filter for attitude estimation. Signal labels: $\theta_{ref}$ = reference angle, $\omega_{sp}$ = rate setpoint, $\omega$ = angular rate, $\hat{\theta}$ = estimated angle.}
    \label{fig:cascade_block}
\end{figure}


\subsubsection{Complementary Filter}

The attitude feedback is obtained through a complementary filter, which combines gyroscope and accelerometer data \cite{narkhede_filter}:
\begin{equation}
    \hat{\theta} = \underbrace{(1-\alpha) \int \omega_{gyro} \, dt}_{\text{High-Pass Gyro}} + \underbrace{\alpha \cdot \theta_{accel}}_{\text{Low-Pass Accel}}
\end{equation}
where $\alpha \approx 0.04$ provides optimal fusion - the gyroscope gives accurate short-term measurements while the accelerometer corrects long-term drift.

\subsection{Angle Controller Tuning}

The tuning process focused on the outer loop PI gains ($K_{p,angle}$ and $K_{i,angle}$). As our rate mode was successful, we avoided interfering with the PID inputs for the rate loop to maintain inner loop stability.

The Angle gains were tuned iteratively using blackbox log analysis:

\begin{table}[H]
\centering
\caption{Angle Mode Tuning Iterations}
\label{tab:angle_tuning}
\begin{tabular}{|c|c|c|l|}
\hline
\textbf{Iteration} & \textbf{$K_{p,angle}$} & \textbf{$K_{i,angle}$} & \textbf{Outcome} \\
\hline
1 & 3.0 & 0.0 & Sluggish, steady-state trim error \\
2 & 4.0 & 0.0 & Improved, but drift persists \\
3 & 5.0 & 0.0 & Good response, trim error remains \\
4 & 5.0 & 0.5 & \textbf{Optimal} - Fast leveling, zero trim error \\
\hline
\end{tabular}
\end{table}

The final selected values of $K_{p,angle} = 5.0$ and $K_{i,angle} = 0.5$ eliminated steady-state trim errors while maintaining stable response.

\begin{table}[H]
\centering
\caption{Final Angle Mode Parameters}
\label{tab:final_params}
\begin{tabular}{|l|c|c|}
\hline
\textbf{Parameter} & \textbf{Symbol} & \textbf{Value} \\
\hline
Angle Proportional Gain & $K_{p,angle}$ & 5.0 \\
Angle Integral Gain & $K_{i,angle}$ & 0.5 \\
Rate PID ($K_p, K_i, K_d$) & -- & 0.40, 0.20, 0.03 \\
\hline
\end{tabular}
\end{table}

\subsection{Transfer Function Derivation}

In the cascade architecture, the outer angle loop uses the closed-loop rate system $T(s)$ (derived in Section 1) as its inner plant. The angle plant $G_{p,\theta}(s)$ is the rate closed-loop followed by integration from rate to angle:

\begin{equation}
G_{p,\theta}(s) = T(s) \cdot \frac{1}{s}
\label{eq:angle_plant}
\end{equation}

The angle controller is a PI controller:
\begin{equation}
G_{c,\theta}(s) = K_{p,angle} + \frac{K_{i,angle}}{s} = \frac{K_{p,angle} \cdot s + K_{i,angle}}{s}
\end{equation}

The angle mode closed-loop transfer function $T_\theta(s)$ follows the same form as the rate loop:
\begin{equation}
T_\theta(s) = \frac{G_{c,\theta}(s) \cdot G_{p,\theta}(s)}{1 + G_{c,\theta}(s) \cdot G_{p,\theta}(s)}
\end{equation}

\subsection{Stability Analysis}

Stability is verified by checking that all closed-loop poles are in the left half-plane. With the addition of the integral term, the system order increases by one.

\begin{table}[H]
\centering
\caption{Angle Mode Closed-Loop Poles (PI Controller)}
\label{tab:angle_poles}
\begin{tabular}{|c|c|c|c|}
\hline
\textbf{Pole} & \textbf{Location} & \textbf{$\zeta$} & \textbf{$\omega_n$ (rad/s)} \\
\hline
1, 2 & $-100.2 \pm 98.2j$ & 0.71 & 140.3 \\
3, 4 & $-6.72 \pm 2.0j$ & 0.96 & 7.0 \\
5 & $-0.52$ (real) & -- & -- \\
6 & $-0.10$ (real) & -- & -- \\
\hline
\end{tabular}
\end{table}

All six poles are in the left half-plane, confirming asymptotic stability. The dominant poles (3, 4) have $\zeta = 0.96$, indicating overdamped response. The slow pole at $-0.10$ is introduced by the integral term and provides zero steady-state error.

\begin{figure}[H]
\centering
\includegraphics[width=0.8\linewidth]{angle_mode_s_plane.png}
\caption{Angle Mode: S-Plane Pole Map showing dominant poles with $\zeta = 0.96$.}
\label{fig:angle_s_plane}
\end{figure}



\subsection{Performance Evaluation}

\begin{table}[H]
\centering
\caption{Angle Mode Step Response Performance}
\label{tab:angle_metrics}
\begin{tabular}{|l|c|l|}
\hline
\textbf{Metric} & \textbf{Value} & \textbf{Interpretation} \\
\hline
Rise time (10-90\%) & 424 ms & Smooth, controlled response \\
Settling time (2\%) & 647 ms & Adequate for attitude hold \\
Overshoot & 0.1\% & Negligible oscillation \\
Steady-state error & 0\% & Zero error (integral action) \\
\hline
\end{tabular}
\end{table}

\begin{figure}[H]
\centering
\includegraphics[width=0.8\linewidth]{angle_mode_step_response.png}
\caption{Step response with zero overshoot and zero steady-state error.}
\label{fig:angle_step}
\end{figure}

\begin{table}[H]
\centering
\caption{Angle Mode Stability Margins}
\label{tab:angle_margins}
\begin{tabular}{|l|c|c|c|}
\hline
\textbf{Margin} & \textbf{Value} & \textbf{Requirement} & \textbf{Status} \\
\hline
Phase margin & 81$^\circ$ & $> 45^\circ$ & Satisfied \\
Gain margin & 33.8 dB & $> 6$ dB & Satisfied \\
\hline
\end{tabular}
\end{table}

\begin{figure}[H]
\centering
\includegraphics[width=0.8\linewidth]{angle_mode_bode.png}
\caption{Bode plot showing stability margins (PI Controller).}
\label{fig:angle_bode}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.8\linewidth]{rate_vs_angle_comparison.png}
\caption{Comparison of Rate Mode and Angle Mode step responses, demonstrating the cascade control hierarchy.}
\label{fig:comparison}
\end{figure}

\subsection{Discussion \& Conclusion}

The cascade controller with PI angle control is stable with $\zeta = 0.96$ (overdamped). The addition of the integral term ($K_{i,angle} = 0.5$) provides:
\begin{itemize}
    \item Zero steady-state error for step inputs
    \item Elimination of trim offset caused by sensor bias or CG imbalance
    \item Slow pole at $s = -0.1$ for gradual error correction
\end{itemize}

The stability margins exceed requirements (PM $> 45Â°$, GM $> 6$ dB), confirming robust operation. The angle mode successfully compensates for the drift observed in rate mode by maintaining the commanded attitude using accelerometer feedback with integral action.

% ===========================================================================
% REFERENCES
% ===========================================================================

\begin{thebibliography}{9}

\bibitem{khatoon_dynamic}
Khatoon, S., Gupta, D., \& Das, L. K. (2014). ``Dynamic modeling and stabilization of quadrotor using PID controller''. \textit{Proceedings of the 2014 International Conference on Advances in Computing, Communications and Informatics (ICACCI)}, Jamia Millia Islamia, New Delhi, India.

\bibitem{ijrte_stability}
Senthil Kumar, K., et al. (2019). ``Analysis of the Stability of Quadcopter and Control using PID Controller''. \textit{International Journal of Recent Technology and Engineering (IJRTE)}, Volume-8 Issue-2S11. Blue Eyes Intelligence Engineering \& Sciences Publication, India.

\bibitem{ijctac_pid}
Kotian, A., et al. ``Modeling and Simulation of Quadcopter using PID Controller''. \textit{International Journal of Current Trends in Advanced Computing (IJCTAC)}, India. 

\bibitem{narkhede_filter}
Narkhede, P., et al. (2021). ``Cascaded Complementary Filter Architecture for Sensor Fusion in Attitude Estimation''. \textit{CSIR-Central Scientific Instruments Organisation}, Chandigarh, India.

\end{thebibliography}

\end{document}
